{% extends "base.html" %}


{% block title %}Detalle del Grupo - Mi Aplicación{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Título del grupo -->
    <div class="row mt-1">
        <div class="col text-center">
            <h3 class="mt-1 mb-1">{{ group_data.id_group }}: {{ group_data.nombre_circuito }}</h3>
        </div>
    </div>

    <!-- Sección de información del grupo -->
    <div class="row mt-2">
        <!-- Primer bloque (izquierda) -->
        <div class="col-md-3">
            <div class="card" style="background-color: #BDD8F1; border-radius: 10px;">
                <div class="card-body p-2">
                    <h5>Información General</h5>
                    <div class="row">
                        <!-- Columna izquierda (más ancha) -->
                        <div class="col-8">
                            <p><strong>ID Grupo:</strong> {{ group_data.id_group }}</p>
                            <p>
                                <strong>Guía:</strong> {{ group_data.guide_name or 'No asignado' }}
                                <a href="#" class="ml-2 edit-icon"><i class="fas fa-edit"></i></a>
                            </p>
                            <p>
                                <strong>Bus:</strong> {{ group_data.bus_company or 'No asignado' }}
                                <a href="#" class="ml-2 edit-icon"><i class="fas fa-edit"></i></a>
                            </p>
                        </div>
                        <!-- Columna derecha (más estrecha) -->
                        <div class="col-4 d-flex justify-content-center">
                            <!-- Estado posicionado más arriba -->
                            <div class="align-self-start mt-2">
                                <span class="badge badge-pill badge-success" style="font-size: 1.2rem; padding: 10px;">{{ group_data.status | capitalize }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Segundo bloque (central, más ancho) -->
        <div class="col-md-5">
            <div class="card" style="background-color: #BDD8F1; border-radius: 10px;">
                <div class="card-body p-2">
                    <h5>Itinerario</h5>
                    <div class="row">
                        <div class="col">
                            <p><strong>Vuelo de Llegada:</strong> {{ group_data.start_flight or 'No asignado' }}</p>
                            <p><strong>Fecha de Inicio:</strong> {{ group_data.start_date }}</p>
                            <p><strong>Ciudad Actual:</strong> {{ group_data.ciudad_actual or 'N/A' }}</p>
                        </div>
                        <div class="col">
                            <p><strong>Vuelo de Regreso:</strong> {{ group_data.end_flight or 'No asignado' }}</p>
                            <p><strong>Fecha de Regreso:</strong> {{ group_data.end_date }}</p>
                            <p><strong>Hotel Actual:</strong> {{ group_data.hotel_actual or 'N/A' }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tercer bloque (derecha, más estrecho) -->
        <div class="col-md-4">
            <div class="card" style="background-color: #BDD8F1; border-radius: 10px;">
                <div class="card-body p-2">
                    <h5>Contacto</h5>
                    <div class="row">
                        <!-- Subdivisión lateral -->
                        <div class="col-6">
                            <p>
                                <strong>Operador:</strong> {{ group_data.operaciones_name or 'No asignado' }}
                                <a href="#" class="ml-2 edit-icon"><i class="fas fa-edit"></i></a>
                            </p>
                            <p>
                                <strong>Asistente:</strong> {{ group_data.nombre_asistente or 'No asignado' }}
                                <a href="#" class="ml-2 edit-icon"><i class="fas fa-edit"></i></a>
                            </p>
                            <p>
                                <strong>Hoteles:</strong> {{ group_data.id_responsible_hotels or 'No asignado' }}
                                <a href="#" class="ml-2 edit-icon"><i class="fas fa-edit"></i></a>
                            </p>
                            <p>
                                <strong>QR enviado:</strong> {{ 'Sí' if group_data.QR else 'No' }}
                                <a href="#" class="ml-2 edit-icon"><i class="fas fa-edit"></i></a>
                            </p>
                        </div>
                        <div class="col-6 d-flex align-items-center justify-content-center">
                            <!-- Mini mapa -->
                            <a href="#" data-toggle="modal" data-target="#mapModal">
                                <img src="{{ url_for('static', path='images/mini_mapa.png') }}" alt="Mapa" class="img-fluid" style="border-radius: 0px;">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para el mapa ampliado -->
    <div class="modal fade" id="mapModal" tabindex="-1" role="dialog" aria-labelledby="mapModalLabel" aria-hidden="true">
      <!-- Contenido del modal permanece igual -->
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="mapModalLabel">Ubicación del Grupo</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <!-- Mapa ampliado -->
            <div id="mapContainer" style="height: 500px;">
                <!-- Aquí irá el mapa interactivo -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Barra de pestañas -->
    <!-- Permanece igual -->
<!-- Barra de pestañas -->
<ul class="nav nav-tabs mt-3" id="myTab" role="tablist">
    <li class="nav-item">
        <a class="nav-link active" id="clientes-tab" data-toggle="tab" href="#clientes" role="tab" aria-controls="clientes" aria-selected="true">Clientes</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="hoteles-tab" data-toggle="tab" href="#hoteles" role="tab" aria-controls="hoteles" aria-selected="false">Hoteles</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="cuartos-tab" data-toggle="tab" href="#cuartos" role="tab" aria-controls="cuartos" aria-selected="false">Cuartos</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="opcionales-tab" data-toggle="tab" href="#opcionales" role="tab" aria-controls="opcionales" aria-selected="false">Opcionales</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" id="liquidacion-tab" data-toggle="tab" href="#liquidacion" role="tab" aria-controls="liquidacion" aria-selected="false">Liquidación</a>
    </li>
</ul>

<!-- Contenido de las pestañas -->
<div class="tab-content" id="myTabContent">
    <!-- Clientes -->
    <div class="tab-pane fade show active" id="clientes" role="tabpanel" aria-labelledby="clientes-tab">
        <!-- Contenido de Clientes -->
        <h3 class="mt-3">Lista de Clientes</h3>
        <!-- Tabla de clientes con datos ficticios -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-light">
                    <tr>
                        <th>Nombre</th>
                        <th>Pasaporte</th>
                        <th>Teléfono</th>
                        <th>Fecha de Nacimiento</th>
                        <th>Email</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Juan Pérez</td>
                        <td>AB123456</td>
                        <td>+34 600 123 456</td>
                        <td>15/05/1985</td>
                        <td>juan.perez@example.com</td>
                    </tr>
                    <tr>
                        <td>María García</td>
                        <td>CD789012</td>
                        <td>+34 600 654 321</td>
                        <td>22/08/1990</td>
                        <td>maria.garcia@example.com</td>
                    </tr>
                    <!-- Agrega más filas según sea necesario -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- Hoteles -->
    <div class="tab-pane fade" id="hoteles" role="tabpanel" aria-labelledby="hoteles-tab">
        <!-- Contenido de Hoteles -->
        <h3 class="mt-3">Lista de Hoteles</h3>
        <!-- Tabla de hoteles con datos ficticios -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-light">
                    <tr>
                        <th>Ciudad</th>
                        <th>Hotel</th>
                        <th>Fecha de Entrada</th>
                        <th>Fecha de Salida</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Londres</td>
                        <td>Hotel London</td>
                        <td>01/01/2024</td>
                        <td>03/01/2024</td>
                    </tr>
                    <tr>
                        <td>Dublín</td>
                        <td>Hotel Dublin</td>
                        <td>04/01/2024</td>
                        <td>06/01/2024</td>
                    </tr>
                    <!-- Agrega más filas según sea necesario -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- Cuartos -->
    <div class="tab-pane fade" id="cuartos" role="tabpanel" aria-labelledby="cuartos-tab">
        <!-- Contenido de Cuartos -->
        <h3 class="mt-3">Lista de Cuartos</h3>
        <!-- Tabla de cuartos con datos ficticios -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-light">
                    <tr>
                        <th>Número de Cuarto</th>
                        <th>Hotel</th>
                        <th>Clientes</th>
                        <th>Tipo de Habitación</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>101</td>
                        <td>Hotel London</td>
                        <td>Juan Pérez</td>
                        <td>Doble</td>
                    </tr>
                    <tr>
                        <td>102</td>
                        <td>Hotel London</td>
                        <td>María García</td>
                        <td>Doble</td>
                    </tr>
                    <!-- Agrega más filas según sea necesario -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- Opcionales -->
    <div class="tab-pane fade" id="opcionales" role="tabpanel" aria-labelledby="opcionales-tab">
        <!-- Contenido de Opcionales -->
        <h3 class="mt-3">Lista de Opcionales</h3>
        <!-- Tabla de opcionales con datos ficticios -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-light">
                    <tr>
                        <th>Actividad</th>
                        <th>Fecha</th>
                        <th>Clientes Inscritos</th>
                        <th>Precio</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Tour en Londres</td>
                        <td>02/01/2024</td>
                        <td>Juan Pérez, María García</td>
                        <td>50€</td>
                    </tr>
                    <!-- Agrega más filas según sea necesario -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- Liquidación -->
    <div class="tab-pane fade" id="liquidacion" role="tabpanel" aria-labelledby="liquidacion-tab">
        <!-- Contenido de Liquidación -->
        <h3 class="mt-3">Liquidación</h3>
        <!-- Información de liquidación con datos ficticios -->
        <p><strong>Total Ingresos:</strong> 10,000€</p>
        <p><strong>Total Gastos:</strong> 8,000€</p>
        <p><strong>Beneficio Neto:</strong> 2,000€</p>
    </div>
</div>
</div>

<!-- Estilos -->
<style>
    .edit-icon {
        display: none;
        color: #007bff;
    }
    p:hover .edit-icon {
        display: inline;
    }
    /* Ajustar márgenes y padding */
    h3 {
        margin-top: 0px;
        margin-bottom: 5px;
    }
    /* Centrar el estado "Activo" */
    .badge {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    /* Hacer que las tarjetas tengan la misma altura */
    .card {
        height: 100%;
    }
</style>

<!-- Scripts para el mapa y modal (permanece igual) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" crossorigin=""></script>


<script>
    // Inicializar el mapa cuando el modal se muestra
    var map; // Declaramos la variable map fuera de las funciones

    $(document).ready(function() {
        // Inicializar el mapa cuando el modal se muestra
        $('#mapModal').on('shown.bs.modal', function () {
            if (!map) {
                // Solo inicializamos el mapa si no existe
                map = L.map('mapContainer').setView([51.505, -0.09], 13); // Coordenadas de ejemplo

                // Añadir capa de mapa (OpenStreetMap)
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);

                // Añadir marcador (opcional)
                L.marker([51.505, -0.09]).addTo(map)
                    .bindPopup('Ubicación del grupo')
                    .openPopup();
            } else {
                // Si el mapa ya existe, solo actualizamos su tamaño
                map.invalidateSize();
            }
        });

        // Eliminar el mapa cuando el modal se cierra
        $('#mapModal').on('hidden.bs.modal', function () {
            if (map) {
                map.remove(); // Eliminar la instancia del mapa
                map = null;    // Reiniciar la variable map
            }
        });
    });
</script>
{% endblock %}
